<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PUSLAT KODIKLATAU - Intelligence Database</title>
<style>
body {
    font-family: 'Courier New', monospace;
    background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('BT5.jpg') center/cover no-repeat;
    color: #00ff00;
    padding: 20px;
}
h1 {
    text-align: center;
    color: #00ff00;
    margin-bottom: 30px;
}
.container {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    justify-content: center;
    gap: 30px;
}
.photo-box {
    flex: 0 0 180px;
    text-align: center;
}
.photo-box img {
    width: 180px;
    height: 220px;
    border: 2px solid #00ff00;
    border-radius: 10px;
    object-fit: cover;
    display: block;
    opacity: 0;
    transition: opacity 1s ease-in;
}
.dossier {
    flex: 1;
    border: 1px solid #00ff00;
    padding: 20px;
    border-radius: 10px;
    background: rgba(0,0,0,0.6);
}
.agent-list {
    text-align: center;
    margin-bottom: 20px;
}
.agent-list select {
    background-color: black;
    color: #00ff00;
    border: 1px solid #00ff00;
    padding: 5px;
    border-radius: 5px;
}
</style>
</head>
<body>

<h1>PUSLAT KODIKLATAU - Intelligence Database</h1>

<div class="agent-list">
    <label for="agentSelect">Pilih Personel:</label>
    <select id="agentSelect"></select>
</div>

<div class="container">
    <div class="photo-box">
        <img id="agent-photo" src="" alt="Foto Personel">
    </div>
    <div class="dossier" id="dossier">Memuat data...</div>
</div>

<script>
// === KONFIGURASI ===
const SHEET_ID = "MASUKKAN_ID_SPREADSHEETMU"; // contoh: 1AbCdEfGhIjKlMnOpQrStUvWxYz
const SHEET_NAME = "Sheet1";
const API_KEY = "MASUKKAN_API_KEY_GOOGLEMU"; // aktifkan Google Sheets API di Google Cloud

// === FUNGSI ===
function convertDriveLink(link) {
    if (!link) return "";
    const match = link.match(/[-\w]{25,}/);
    return match ? `https://drive.google.com/uc?export=view&id=${match[0]}` : link;
}

async function loadData() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
    const res = await fetch(url);
    const data = await res.json();
    const rows = data.values;
    if (!rows || rows.length < 2) return;

    const headers = rows[0].map(h => h.trim().toLowerCase());
    const agents = rows.slice(1).map(r => {
        const obj = {};
        headers.forEach((h, i) => obj[h] = r[i] || "");
        return obj;
    });

    populateDropdown(agents);
}

function populateDropdown(agents) {
    const select = document.getElementById("agentSelect");
    select.innerHTML = `<option value="">-- Pilih Personel --</option>`;
    agents.forEach((a, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = a["nama_lengkap"] || `Personel ${i+1}`;
        select.appendChild(opt);
    });

    select.addEventListener("change", () => {
        const val = select.value;
        if (val !== "") displayAgent(agents[val]);
    });
}

function displayAgent(agent) {
    const dossierEl = document.getElementById("dossier");
    const photoEl = document.getElementById("agent-photo");

    // konversi link foto Google Drive
    const photoLink = convertDriveLink(agent.photo);

    // tampilkan foto
    photoEl.src = photoLink || "https://drive.google.com/uc?export=view&id=13KgFyUzOSIUhfK8qw0skSLOEq5Yj0xp2";
    photoEl.style.opacity = 1;

    // tampilkan biodata
    dossierEl.innerHTML = `
        <b>NAMA LENGKAP:</b> ${agent.nama_lengkap || "-"}<br>
        <b>TEMPAT/TGL LAHIR:</b> ${agent.tempat_lahir || "-"}, ${agent.tanggal_lahir || "-"}<br>
        <b>PANGKAT:</b> ${agent.pangkat || "-"}<br>
        <b>NRP/NIP:</b> ${agent.nrp_nip || "-"}<br>
        <b>JABATAN SAAT INI:</b> ${agent.jab_saat_ini || "-"}<br>
        <b>TMT JABATAN:</b> ${agent.tmt_jabatan_saat_ini || "-"}<br>
        <b>SATKER:</b> ${agent.satker || "-"}<br>
        <b>KORP/PROF/SPES:</b> ${agent["korp/prof/spes"] || "-"}<br>
        <b>AGAMA:</b> ${agent.agama || "-"}<br>
        <b>ALAMAT:</b> ${agent.alamat || "-"}<br>
    `;
}

// === JALANKAN ===
loadData();
</script>

</body>
</html>
