<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PUSLAT KODIKLATAU - Online KGB Monitoring</title>
<style>
body {
    font-family: 'Courier New', monospace;
    background-color: black;
    color: #00FF00;
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
}
header {
    text-align: center;
    border-bottom: 1px solid #00FF00;
    padding: 20px 0 10px 0;
}
.text { font-size: 75px; margin-bottom: 0; }
.text1 { font-size: 30px; margin-top: 0; animation: blinkText 1s infinite; }
.main-container { display: flex; flex: 1; border-top: 1px solid #00FF00; }
.search-panel { width: 35%; padding: 20px; border-right: 2px solid #00FF00; display: flex; flex-direction: column; }
.output-panel { flex: 1; padding: 20px; overflow-y: auto; border-left: 2px solid #00FF00; }
input {
    background: transparent; border: 1px solid #00FF00;
    color: #00FF00; padding: 10px; margin-bottom: 15px;
    font-size: 16px; border-radius: 4px;
}
.agent-profile { display: flex; gap: 20px; flex-wrap: wrap; }
.agent-profile pre { flex: 1; white-space: pre-wrap; line-height: 1.4; }
.agent-profile img {
    width: 135px; height: 185px; object-fit: cover;
    border: 2px solid #00FF00; border-radius: 8px;
    display: none; opacity: 0; transition: opacity 1.2s ease-in-out;
}
button {
    background: transparent; border: 1px solid #00FF00;
    color: #00FF00; padding: 8px 15px; border-radius: 4px;
    cursor: pointer; font-family: 'Courier New', monospace;
}
button:hover { background-color: #00FF00; color: black; }
.not-found { color: #FF0000; font-weight: bold; }
@keyframes blinkText { 0%, 50%, 100% { opacity: 1; } 25%, 75% { opacity: 0; } }
</style>
</head>
<body>
<header>
  <h1 class="text">KENAIKAN GAJI BERKALA</h1>
  <h1 class="text1">ONLINE MONITORING TERMINAL</h1>
</header>

<div class="main-container">
  <div class="search-panel">
    <h2>üîç Data Lookup</h2>
    <label for="search">Masukkan Keyword Unit / Nama Lengkap:</label>
    <input type="text" id="search" placeholder="Contoh: DISPERS / Endriady">
    <div id="member-buttons"></div>
  </div>

  <div class="output-panel" id="output">
    <div class="agent-profile" id="agent-container">
      <pre id="agent-dossier">Biodata akan muncul di sini...</pre>
      <img id="agent-photo" src="">
    </div>
  </div>
</div>

<script>
// ====================== KONFIGURASI GOOGLE SHEET ======================
const SHEET_ID = "1BPBcC-p-bd291jVOfhsjtz46K2P36wVWOYQpdHCjyeM";
const SHEET_NAME = "database"; // ganti sesuai nama tab sheet
const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}&t=${Date.now()}`;


// ====================== ELEMENTS ======================
const searchInput = document.getElementById("search");
const memberContainer = document.getElementById("member-buttons");
const dossierEl = document.getElementById("agent-dossier");
const photoEl = document.getElementById("agent-photo");
let personnelDB = [];

// ====================== LOAD DATA DARI GOOGLE SHEET ======================
async function loadData() {
  try {
    const res = await fetch(SHEET_URL);
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0, -2)); // parsing format Google
    personnelDB = json.table.rows.map(r => {
      const c = r.c.map(x => x ? x.v : "");
      return {
        nama_lengkap: c[0],
        pangkat: c[1],
        nrp_nip: c[2],
        jabatan: c[3],
        korp_fung_spes: c[4],
        tanggal_lahir: c[5],
        tempat_lahir: c[6],
        agama: c[7],
        satker: c[8],
        kgb_terakhir: c[9],
        tmt_kgb: c[10],
        akan_datang: c[11],
        ops_completed: c[12],
        specialization: c[13],
        photo: c[14]
      };

  }
}

// ====================== FUNGSI ======================
function showMemberButtons(keyword){
  memberContainer.innerHTML = "";
  const filtered = personnelDB.filter(p =>
    p.satker.toLowerCase().includes(keyword.toLowerCase()) ||
    p.nama_lengkap.toLowerCase().includes(keyword.toLowerCase())
  );
  if(filtered.length === 0){
    memberContainer.innerHTML = '<span class="not-found">‚ùå Tidak ditemukan</span>';
    return;
  }
  filtered.forEach(agent => {
    const btn = document.createElement("button");
    btn.textContent = agent.nama_lengkap;
    btn.onclick = () => showAgent(agent);
    memberContainer.appendChild(btn);
  });
}

function showAgent(agent){
  dossierEl.textContent = `
========================================
| FILE: PERSONEL ${agent.satker} |
========================================
NAMA LENGKAP : ${agent.nama_lengkap}
PANGKAT      : ${agent.pangkat}
NRP/NIP      : ${agent.nrp_nip}
JABATAN      : ${agent.jabatan}
SATKER       : ${agent.satker}
SPESIALISASI : ${agent.korp_fung_spes}
TTL          : ${agent.ttl}
AGAMA        : ${agent.agama}
----------------------------------------
KGB TERAKHIR : ${agent.kgb_terakhir}
KGB AKAN DATANG : ${agent.akan_datang}
----------------------------------------
NOMOR SKEP   : ${agent.nomer_skep}
TMT JABATAN  : ${agent.tmt_jabatan}
MASA JABATAN : ${agent.masa_jabatan}
========================================
Retrieved on: ${new Date().toLocaleString()}
`;

  if(agent.photo){
    photoEl.src = agent.photo;
    photoEl.style.display = "block";
    setTimeout(() => photoEl.style.opacity = 1, 200);
  } else {
    photoEl.style.display = "none";
  }
}

// ====================== EVENT ======================
searchInput.addEventListener("keydown", e => {
  if(e.key === "Enter"){
    const q = searchInput.value.trim();
    if(q) showMemberButtons(q);
  }
});

// ====================== INIT ======================
loadData();
</script>
</body>
</html>
