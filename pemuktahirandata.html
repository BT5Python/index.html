<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PUSLAT KODIKLATAU - Intelligence Database</title>
<style>
/* ======= DASAR HALAMAN ======= */
body{
    font-family: 'Courier New', monospace;
    background-color: black;
    color: #00FF00;
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
}

/* ======= VIDEO BACKGROUND ======= */
#bg-video {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: -1; /* selalu di belakang */
    opacity: 0.6; /* ubah sesuai kebutuhan */
}

/* ======= HEADER ======= */
header {
    background-color: rgba(0, 0, 0, 0.7);
    padding: 20px 0 10px 0;
    text-align: center;
    line-height: 1.1;
    border-bottom: 1px solid #00FF00;
}

.text {
    font-size: 75px;
    margin-bottom: 0;
    color: #FFFF00;
}

.text1 {
    font-size: 30px;
    margin-top: 0;
    color: #FF0000;
    animation: blinkText 1s infinite;
}

.header-buttons button {
    background: transparent;
    border: 1px solid #00FF00;
    color: #00FF00;
    padding: 8px 15px;
    cursor: pointer;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    transition: background 0.3s, color 0.3s;
    margin: 3px;
}
.header-buttons button:hover { background-color: #00FF00; color: black; }

/* ======= MAIN AREA ======= */
.main-container {
    display: flex;
    flex: 1;
    border-top: 1px solid #00FF00;
    background-color: rgba(0, 0, 0, 0.6);
}

/* PANEL KIRI (PENCARIAN) */
.search-panel {
    width: 35%;
    padding: 20px;
    display: flex;
    flex-direction: column;
    border-right: 2px solid #00FF00;
}
.search-panel h2 { text-align: center; margin-bottom: 20px; }
input, select {
    background: transparent;
    border: 1px solid #00FF00;
    color: #00FF00;
    padding: 10px;
    margin-bottom: 15px;
    font-size: 16px;
    border-radius: 4px;
    outline: none;
}
.info-text { font-size: 14px; text-align: center; margin-top: 10px; }
#member-buttons { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; }

/* PANEL KANAN (OUTPUT) */
.output-panel {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    border-left: 2px solid #00FF00;
}
.agent-profile { display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap; }
.agent-profile pre { flex: 1; white-space: pre-wrap; line-height: 1.4; }
.agent-profile img {
    width: 135px; height: 185px; object-fit: cover;
    border: 2px solid #00FF00; border-radius: 8px;
    display: none; opacity: 0; transition: opacity 1.2s ease-in-out;
}
.doc-buttons { display: flex; gap: 10px; margin-top: 15px; }

.highlight-section { color: #FFFF00; font-weight: bold; }
.not-found { color: #FF0000; font-weight: bold; }

@media (max-width: 768px) {
    .main-container { flex-direction: column; }
    .search-panel, .output-panel { width: 100%; border: none; border-bottom: 1px solid #00FF00; }
    .agent-profile { flex-direction: column; align-items: center; }
}

/* ======= RECORDING INDICATOR ======= */
.recording-indicator {
    position: fixed;
    top: 10px;
    left: 15px;
    font-family: 'Courier New', monospace;
    font-size: 20px;
    font-weight: bold;
    color: #FF0000;
    animation: blinkRecording 1s infinite;
    z-index: 9999;
    user-select: none;
}

/* ======= ANIMASI ======= */
@keyframes blinkText { 0%, 50%, 100% { opacity: 1; } 25%, 75% { opacity: 0; } }
@keyframes blinkRecording { 0%, 50%, 100% { opacity: 1; } 25%, 75% { opacity: 0; } }
.secret-alert { color: #FF0000; font-weight: bold; animation: blinkText 1s infinite; }
</style>
</head>
<body>

<!-- ===== VIDEO BACKGROUND ===== -->
<video autoplay muted loop id="bg-video">
  <source src="Desain tanpa judul.mp4" type="video/mp4">
  Browser Anda tidak mendukung video tag.
</video>

<!-- ===== RECORDING TEXT ===== -->
<div class="recording-indicator">● RECORDING</div>

<!-- ===== HEADER ===== -->
<header>
    <h1 class="text">PEMUKTAHIRAN DATA PERSONEL</h1>
    <h1 class="text1">PORTAL MONITORING TERMINAL</h1>
    <div class="header-buttons">
        <button onclick="goTo('https://kodiklatau.tni-au.mil.id/struktur-organisasi')">HOME</button>
        <button onclick="goTo('Struktur Organisasi Puslat.pdf')">STRUKTUR ORGANISASI</button>
        <button onclick="goTo('Jabkosong.html')">JAB KOSONG</button>
        <button onclick="goTo('https://kodiklatau.tni-au.mil.id/radiogram')">PEMUKTAHIRAN DATA</button>
        <button onclick="goTo('https://kodiklatau.tni-au.mil.id/jab-kosong')">RIWAYAT HIDUP</button>
        <button onclick="goTo('https://kodiklatau.tni-au.mil.id/jab-kosong')">KU-1</button>
        <button onclick="goTo('https://kodiklatau.tni-au.mil.id/jab-kosong')">RADIOGRAM</button>
        <button onclick="goTo('https://kodiklatau.tni-au.mil.id/juknis')">BACK</button>
        <button onclick="goTo('https://kodiklatau.tni-au.mil.id/orgas-puslat')">NEXT</button>
    </div>
</header>

<!-- ===== MAIN CONTAINER ===== -->
<div class="main-container">
    <div class="search-panel">
        <h2>Puslat Kodiklatau</h2>
        <label for="category-filter">Filter By Category:</label>
        <select id="category-filter">
          <option value="">-- All Categories --</option>
        </select>

        <label for="search">Enter the Unit Keyword / Full Name</label>
        <input type="text" id="search" placeholder="">
        <p class="info-text">Select a category and type a keyword, then press ENTER to display a list of members</p>
        <div id="member-buttons"></div>
    </div>

    <div class="output-panel" id="output">
        <div class="agent-profile" id="agent-container">
            <pre id="agent-dossier">
Biodata will appear after clicking the member button
            </pre>
            <img id="agent-photo" src="" alt="Foto Personel">
        </div>
    </div>
</div>

<!-- ===== SCRIPT ===== -->
<script>
function goTo(url) { window.location.href = url; }

let personnelDB = [];

fetch("https://script.google.com/macros/s/AKfycbyBLR9WNavK1tzFJt6YCtJhKY6Pzoa3Ho9g-G9fvubNc7pAlhuDhzmteIE0w-hqBo6b/exec")
  .then(res => res.json())
  .then(data => {
    personnelDB = data;
    populateCategoryDropdown();
  })
  .catch(err => console.error("❌ Gagal memuat data:", err));

function populateCategoryDropdown() {
  const categorySelect = document.getElementById("category-filter");
  const uniqueCategories = [...new Set(personnelDB.map(p => p.kategori).filter(Boolean))];
  uniqueCategories.sort();
  uniqueCategories.forEach(cat => {
    const opt = document.createElement("option");
    opt.value = cat;
    opt.textContent = cat;
    categorySelect.appendChild(opt);
  });
}

const searchInput = document.getElementById("search");
const dossierEl = document.getElementById("agent-dossier");
const photoEl = document.getElementById("agent-photo");
const memberBtnContainer = document.getElementById("member-buttons");
const agentContainer = document.getElementById("agent-container");
const outputPanel = document.getElementById("output");

function formatTanggalIndonesia(dateStr) {
    if (!dateStr) return "-";
    let date;
    try {
        date = new Date(dateStr);
        if (isNaN(date)) {
            const parts = dateStr.includes("/") ? dateStr.split("/") : dateStr.split("-");
            if (parts.length === 3) {
                const [d, m, y] = parts.map(Number);
                date = new Date(y, m - 1, d);
            } else return dateStr;
        }
    } catch {
        return dateStr;
    }
    const d = String(date.getDate()).padStart(2, "0");
    const m = String(date.getMonth() + 1).padStart(2, "0");
    const y = date.getFullYear();
    return `${d}/${m}/${y}`;
}

function calculateAge(birthDateStr) {
    if (!birthDateStr) return "-";
    const date = new Date(birthDateStr);
    if (isNaN(date)) return "-";
    const today = new Date();
    let age = today.getFullYear() - date.getFullYear();
    if (today.getMonth() < date.getMonth() ||
        (today.getMonth() === date.getMonth() && today.getDate() < date.getDate())) {
        age--;
    }
    return age;
}

function simulateAccessSequence(element, callback){
    const steps = [
        ">>> initializing connection...",
        ">>> accessing database node...",
        ">>> verifying security clearance...",
        ">>> clearance level verified ✔",
        ">>> retrieving personnel data..."
    ];
    let i=0;
    element.textContent="";
    function nextStep(){
        if(i<steps.length){
            element.textContent += steps[i] + "\n";
            outputPanel.scrollTop = outputPanel.scrollHeight;
            i++;
            setTimeout(nextStep, 600);
        } else { setTimeout(callback, 600); }
    }
    nextStep();
}

function showMemberButtons(keyword){
  memberBtnContainer.innerHTML = "";
  const selectedCategory = document.getElementById("category-filter").value;
  const filtered = personnelDB.filter(p => {
    const kw = keyword.toLowerCase();
    const matchKeyword = 
      (p.satker && p.satker.toLowerCase().includes(kw)) ||
      (p.nama_lengkap && p.nama_lengkap.toLowerCase().includes(kw)) ||
      (p.kategori && p.kategori.toLowerCase().includes(kw));
    const matchCategory = !selectedCategory || p.kategori === selectedCategory;
    return matchKeyword && matchCategory;
  });

  if(filtered.length === 0){
    memberBtnContainer.innerHTML = '<span class="not-found">❌ No members found</span>';
  } else {
    filtered.forEach(agent => {
      const btn = document.createElement("button");
      btn.textContent = agent.nama_lengkap;
      btn.onclick = () => displayAgent(agent);
      memberBtnContainer.appendChild(btn);
    });
  }
}

function displayAgent(agent) {
    let photoURL = agent.photo || "https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png";
    if (photoURL.includes("drive.google.com")) {
        const match = photoURL.match(/\/d\/([a-zA-Z0-9_-]+)/);
        if (match && match[1]) photoURL = `https://drive.google.com/uc?export=view&id=${match[1]}`;
    }

    photoEl.src = photoURL;
    photoEl.style.display = "block";
    photoEl.style.opacity = 1;

    simulateAccessSequence(dossierEl, () => {
        dossierEl.textContent = `
========================================
|   FILE: PERSONEL PUSLAT KODIKLATAU   |
|   CLASSIFICATION: RAHASIA            |
========================================

NAMA: ${agent.nama_lengkap || "-"}
PANGKAT: ${agent.pangkat || "-"}
NRP: ${agent.nrp_nip || "-"}
SATKER: ${agent.satker || "-"}
TANGGAL LAHIR: ${formatTanggalIndonesia(agent.tanggal_lahir)}
USIA: ${calculateAge(agent.tanggal_lahir)} Tahun
        `;
    });
}

searchInput.addEventListener("keydown", e=>{
    if(e.key==="Enter"){
        const query = searchInput.value.trim();
        if(query) showMemberButtons(query);
    }
});
</script>
</body>
</html>
