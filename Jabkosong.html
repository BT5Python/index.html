<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jabatan Kosong | PUSLAT KODIKLATAU</title>
<style>
body {
  background-color: black;
  color: #00ff00;
  font-family: "Courier New", monospace;
  padding: 20px;
  font-size: 12px;
}
pre { white-space: pre-wrap; word-wrap: break-word; letter-spacing: 1px; line-height: 1.5; }
.typing {
  border-right: 2px solid #00ff00;
  animation: blinkCursor 0.7s infinite;
}
@keyframes blinkCursor { 50% { border-color: transparent; } }

.blink-red {
  color: #ff0000;
  animation: blinkRed 0.45s infinite;
}
@keyframes blinkRed {
  0%, 100% { color: #ff0000; }
  50% { color: #330000; }
}

.yellow { color: #ffff00; font-weight: bold; }

.buttons {
  text-align: center;
  margin-top: 30px;
}
.button {
  border: 1px solid #00ff00;
  color: #00ff00;
  padding: 8px 16px;
  margin: 4px;
  background: transparent;
  cursor: pointer;
  font-family: 'Courier New', monospace;
  font-weight: bold;
}
.button:hover {
  background-color: #00ff00;
  color: black;
}
.blink-download {
  border-color: #ff0000;
  color: #ff0000;
  animation: blinkRed 0.5s infinite;
}
</style>
</head>
<body>
<pre id="terminal" class="typing"></pre>

<div class="buttons">
  <button class="button" onclick="history.back()">BACK</button>
  <button id="downloadBtn" class="button blink-download" onclick="downloadPDF()">DOWNLOAD</button>
</div>

<script>
const textBefore = `
>>> initializing connection...
>>> accessing database node...
>>> verifying security clearance...
>>> clearance level verified âœ“
>>> retrieving personnel data...
`;

const terminal = document.getElementById("terminal");

async function fetchData() {
  const url = "https://script.google.com/macros/s/AKfycbzBYm7QSOuamAty3WbwXgXvyV9pwsYShharbNnBH89i4Tw5FmitP_XFPn96jR2JKqya/exec";
  const res = await fetch(url);
  return res.json();
}

async function typeText(text) {
  for (let i = 0; i < text.length; i++) {
    terminal.textContent += text.charAt(i);
    await new Promise(r => setTimeout(r, 10));
  }
}

async function main() {
  await typeText(textBefore);

  const dataObj = await fetchData();
  const data = dataObj.data;
  const judul = dataObj.data[0]?.judul || "DAFTAR JABATAN KOSONG";
  const subjudul = dataObj.data[0]?.subjudul || "PUSLAT KODIKLATAU";

  terminal.innerHTML += `\n====================================\n`;
  terminal.innerHTML += `| ${judul} |\n`;
  terminal.innerHTML += `| ${subjudul} |\n`;
  terminal.innerHTML += `====================================\n\n`;
  terminal.innerHTML += `<span class="yellow">[   DAFTAR JABATAN KOSONG   ]</span>\n\n`;
  terminal.innerHTML += `
------------------------------------------------------------------------------------
NO    JABATAN KOSONG               GOL.JAB   PANGKAT                  KORPS
------------------------------------------------------------------------------------\n`;

  data.forEach((row, idx) => {
    const line = `${row.no.toString().padEnd(5)}${row.jabatan.padEnd(30)}${row.golongan.padEnd(10)}${row.pangkat.padEnd(25)}${row.korps}\n`;
    if (line.toUpperCase().includes("PNS")) {
      terminal.innerHTML += `<span class="yellow">${line}</span>`;
    } else {
      terminal.innerHTML += line;
    }
  });

  terminal.innerHTML += `
------------------------------------------------------------------------------------
* Data jabatan kosong diperbarui otomatis dari Spreadsheet.
* Informasi hanya untuk lingkungan PUSLAT KODIKLATAU.
------------------------------------------------------------------------------------`;

  terminal.classList.remove("typing");

  // Simpan link PDF untuk tombol download
  window.pdfLink = dataObj.pdf || "";
}

function downloadPDF() {
  if (window.pdfLink) {
    window.open(window.pdfLink, "_blank");
  } else {
    alert("File PDF belum tersedia.");
  }
}

main();
</script>
</body>
</html>
