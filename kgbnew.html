<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PUSLAT KODIKLATAU - Intelligence Database</title>
<style>
body {
    font-family: 'Courier New', monospace;
    background-color: black;
    color: #00FF00;
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
}
header {
    text-align: center;
    padding: 20px 0 10px 0;
    border-bottom: 1px solid #00FF00;
}
.text { font-size: 75px; margin-bottom: 0; }
.text1 { font-size: 30px; margin-top: 0; animation: blinkText 1s infinite; }
.header-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 15px;
}
.header-buttons button {
    background: transparent;
    border: 1px solid #00FF00;
    color: #00FF00;
    padding: 8px 15px;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.3s, color 0.3s;
}
.header-buttons button:hover {
    background-color: #00FF00;
    color: black;
}
.main-container {
    display: flex;
    flex: 1;
    border-top: 1px solid #00FF00;
}
.search-panel {
    width: 35%;
    padding: 20px;
    border-right: 2px solid #00FF00;
}
.search-panel h2 { text-align: center; margin-bottom: 20px; }
input {
    background: transparent;
    border: 1px solid #00FF00;
    color: #00FF00;
    padding: 10px;
    margin-bottom: 15px;
    font-size: 16px;
    border-radius: 4px;
}
.output-panel {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    border-left: 2px solid #00FF00;
}
.agent-profile { display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-start; }
.agent-profile pre {
    flex: 1;
    white-space: pre-wrap;
    line-height: 1.4;
}
.agent-profile img {
    width: 135px;
    height: 185px;
    object-fit: cover;
    border: 2px solid #00FF00;
    border-radius: 8px;
    display: none;
    opacity: 0;
    transition: opacity 1.2s ease-in-out;
}
.not-found { color: #FF0000; font-weight: bold; }
.agent-profile button {
    background: transparent;
    border: 1px solid #00FF00;
    color: #00FF00;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 4px;
}
.agent-profile button:hover { background-color: #00FF00; color: black; }
@keyframes blinkText {
    0%, 50%, 100% { opacity: 1; }
    25%, 75% { opacity: 0; }
}
</style>
</head>
<body>
<header>
    <h1 class="text">KENAIKAN GAJI BERKALA</h1>
    <h1 class="text1">MONITORING TERMINAL</h1>
</header>

<div class="main-container">
    <div class="search-panel">
        <h2>üîç Data Lookup</h2>
        <input type="text" id="search" placeholder="Masukkan Nama / Unit...">
        <div id="member-buttons"></div>
    </div>
    <div class="output-panel">
        <div class="agent-profile">
            <pre id="agent-dossier">Biodata will appear after clicking the member button</pre>
            <img id="agent-photo" src="" alt="Foto Personel">
        </div>
    </div>
</div>

<script>
// ======= CONFIGURATION =======
const SHEET_URL = "PASTE_WEB_APP_URL_DISINI"; // <== Ganti dengan URL Apps Script

let personnelDB = [];
const searchInput = document.getElementById("search");
const dossierEl = document.getElementById("agent-dossier");
const photoEl = document.getElementById("agent-photo");
const memberBtnContainer = document.getElementById("member-buttons");
const outputPanel = document.querySelector(".output-panel");

// ======= FETCH DATA DARI SPREADSHEET =======
async function loadData() {
  dossierEl.textContent = "Loading personnel data from server...";
  try {
    const res = await fetch(SHEET_URL);
    personnelDB = await res.json();
    dossierEl.textContent = "Database connected. Type keyword to search.";
  } catch (err) {
    dossierEl.textContent = "‚ùå Failed to load data. Check your Google Script URL.";
  }
}
loadData();

// ======= FUNGSI UTIL =======
function getDetailedDiff(startDateStr) {
  if (!startDateStr) return "-";
  const [day, month, year] = startDateStr.split(/[\/\-]/).map(Number);
  if (!day || !month || !year) return "-";
  const startDate = new Date(year, month - 1, day);
  const today = new Date();
  let years = today.getFullYear() - startDate.getFullYear();
  let months = today.getMonth() - startDate.getMonth();
  let days = today.getDate() - startDate.getDate();
  if (days < 0) { months--; days += 30; }
  if (months < 0) { years--; months += 12; }
  return `${years} Tahun ${months} Bulan ${days} Hari`;
}
function calculateAge(birthDateStr) {
  const [day, month, year] = birthDateStr.split(/[\-\/]/).map(Number);
  const today = new Date();
  let age = today.getFullYear() - year;
  if (today.getMonth()+1 < month || (today.getMonth()+1===month && today.getDate()<day)) age--;
  return age;
}

// ======= PENCARIAN =======
searchInput.addEventListener("keydown", e=>{
  if(e.key==="Enter"){
    const q = searchInput.value.trim().toLowerCase();
    memberBtnContainer.innerHTML="";
    if(!q) return;
    const found = personnelDB.filter(p => 
      p.nama_lengkap.toLowerCase().includes(q) ||
      p.satker.toLowerCase().includes(q)
    );
    if(found.length===0){
      memberBtnContainer.innerHTML='<span class="not-found">‚ùå No members found</span>';
    } else {
      found.forEach(p=>{
        const btn = document.createElement("button");
        btn.textContent = p.nama_lengkap;
        btn.onclick = ()=> showAgent(p);
        memberBtnContainer.appendChild(btn);
      });
    }
  }
});

// ======= TAMPILAN PROFIL =======
function showAgent(agent){
  photoEl.style.display="none"; photoEl.style.opacity=0;
  dossierEl.textContent=">>> accessing personnel file...";
  setTimeout(()=>{
    const usia = calculateAge(agent.tanggal_lahir);
    const masaKGB = getDetailedDiff(agent.kgb_terakhir);
    const masaKerja = getDetailedDiff(agent.ops_completed);
    const text = `
========================================
|   FILE: PERSONEL PUSLAT KODIKLATAU   |
|   CLASSIFICATION: RAHASIA            |
========================================

NAMA LENGKAP       : ${agent.nama_lengkap}
PANGKAT            : ${agent.pangkat}
NRP/NIP            : ${agent.nrp_nip}
JABATAN            : ${agent.jabatan}
SATKER             : ${agent.satker}
KORPS/SPESIALISASI : ${agent.korp_fung_spes}
TEMPAT/TGL LAHIR   : ${agent.tempat_lahir}, ${agent.tanggal_lahir}
AGAMA              : ${agent.agama}
USIA               : ${usia} Tahun

KGB TERAKHIR       : ${agent.kgb_terakhir} (${masaKGB} lalu)
KGB AKAN DATANG    : ${agent.akan_datang}

NOMOR SKEP         : ${agent.specialization}
TMT JABATAN        : ${agent.ops_completed}
MASA JABATAN       : ${masaKerja}

========================================
Retrieved on: ${new Date().toLocaleString()}
    `;
    dossierEl.textContent = text;
    if(agent.photo){
      photoEl.src = agent.photo;
      photoEl.style.display = "block";
      setTimeout(()=>photoEl.style.opacity=1,300);
    }
  }, 600);
}
</script>
</body>
</html>
